<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kullanıcı Yönetimi</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
          darkMode: 'class',
          theme: {
            extend: {
              backgroundImage: {
                'arka-plan': 'linear-gradient(90deg,#667eea 0%,#764ba2 100%)',
              },
            },
          },
        };
    </script>
</head>
<body class="bg-arka-plan min-h-screen flex flex-col text-gray-100">

<!-- Başlık -->
<header class="container mx-auto py-6">
    <h1 class="text-4xl font-bold mb-2">Kullanıcı Yönetimi</h1>
    <p class="opacity-80">
        Spring Boot <code class="bg-gray-800 rounded px-1">/users</code> uç noktaları üzerinden CRUD işlemleri.
    </p>
</header>

<!-- Ana Izgara -->
<main class="container mx-auto grid grid-cols-1 gap-8 md:grid-cols-2">

    <!-- Form Kartı -->
    <section class="rounded-2xl bg-white/10 p-6 shadow-xl backdrop-blur-lg hover:shadow-2xl transition-shadow">
        <h2 id="form-baslik" class="mb-4 text-2xl font-semibold">Kullanıcı Oluştur</h2>
        <form id="kullanici-formu" class="space-y-4">
            <div>
                <label for="kullaniciId" class="block text-sm font-medium">Kullanıcı ID (Güncelleme İçin)</label>
                <input type="text" id="kullaniciId" name="kullaniciId"
                       readonly
                       class="mt-1 block w-full rounded-md border border-gray-600 bg-gray-800/40 p-2" />
            </div>

            <div>
                <label for="ad" class="block text-sm font-medium">Ad ve Soyad</label>
                <input type="text" id="ad" name="ad"
                       placeholder="Adınızı ve Soyadınızı girin" required
                       class="mt-1 block w-full rounded-md border border-gray-600 bg-gray-800/40 p-2" />
            </div>

            <div>
                <label for="eposta" class="block text-sm font-medium">E-posta</label>
                <input type="email" id="eposta" name="eposta"
                       placeholder="ornek@mail.com" required
                       class="mt-1 block w-full rounded-md border border-gray-600 bg-gray-800/40 p-2" />
            </div>

            <div class="flex gap-4">
                <button type="submit" id="gonderBtn"
                        class="flex-1 rounded-md bg-indigo-500 py-2 font-semibold transition-colors hover:bg-indigo-600">
                    Kullanıcı Oluştur
                </button>
                <button type="button" id="sifirlaBtn"
                        class="flex-1 rounded-md bg-gray-500 py-2 font-semibold transition-colors hover:bg-gray-600">
                    Sıfırla
                </button>
            </div>
        </form>
    </section>

    <!-- Kullanıcılar Tablosu Kartı -->
    <section class="overflow-x-auto rounded-2xl bg-white/10 p-6 shadow-xl backdrop-blur-lg hover:shadow-2xl transition-shadow">
        <div class="mb-4 flex items-center justify-between">
            <h2 class="text-2xl font-semibold">Tüm Kullanıcılar</h2>
            <button type="button" id="tumunuGetirBtn"
                    class="rounded-md bg-emerald-500 px-4 py-2 font-semibold transition-colors hover:bg-emerald-600">
                Yenile
            </button>
        </div>

        <table id="kullanicilarTablo" class="min-w-full divide-y divide-gray-600 text-sm">
            <thead class="bg-gray-800/60">
            <tr>
                <th class="px-3 py-2 text-left">ID</th>
                <th class="px-3 py-2 text-left">Ad ve Soyad</th>
                <th class="px-3 py-2 text-left">E-posta</th>
                <th class="px-3 py-2 text-left">İşlemler</th>
            </tr>
            </thead>
            <tbody class="divide-y divide-gray-700"><!-- Dinamik --></tbody>
        </table>
    </section>

    <!-- Arama Kartı -->
    <section class="md:col-span-2 rounded-2xl bg-white/10 p-6 shadow-xl backdrop-blur-lg hover:shadow-2xl transition-shadow">
        <h2 class="mb-4 text-2xl font-semibold">Kullanıcı Ara</h2>
        <div class="grid gap-4 sm:grid-cols-3">
            <div class="flex gap-2">
                <input type="number" id="araId"
                       placeholder="ID"
                       class="flex-1 rounded-md border border-gray-600 bg-gray-800/40 p-2" />
                <button id="araIdBtn"
                        class="rounded-md bg-blue-500 px-3 py-2 font-semibold transition-colors hover:bg-blue-600">
                    Ara
                </button>
            </div>
            <div class="flex gap-2">
                <input type="text" id="araAd"
                       placeholder="Ad veya Soyad"
                       class="flex-1 rounded-md border border-gray-600 bg-gray-800/40 p-2" />
                <button id="araAdBtn"
                        class="rounded-md bg-blue-500 px-3 py-2 font-semibold transition-colors hover:bg-blue-600">
                    Ara
                </button>
            </div>
            <div class="flex gap-2">
                <input type="email" id="araEposta"
                       placeholder="E-posta"
                       class="flex-1 rounded-md border border-gray-600 bg-gray-800/40 p-2" />
                <button id="araEpostaBtn"
                        class="rounded-md bg-blue-500 px-3 py-2 font-semibold transition-colors hover:bg-blue-600">
                    Ara
                </button>
            </div>
        </div>

        <div id="aramaSonuc" class="hidden mt-4">
            <h3 class="mb-1 text-xl font-semibold">Sonuç</h3>
            <p id="sonucIcerik" class="whitespace-pre-line"></p>
        </div>
    </section>
</main>

<!-- Karanlık Mod Anahtarı -->
<button id="temaBtn" title="Karanlık mod"
        class="fixed bottom-6 right-6 rounded-full bg-black/40 p-3 shadow-lg backdrop-blur-lg transition-transform hover:scale-105">
    <svg id="temaIkon" xmlns="http://www.w3.org/2000/svg"
         class="h-6 w-6 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 4.354a1 1 0 011 .987v.678a8 8 0 11-7.665 11.06 1 1 0 011.4-1.314A6 6 0 1012 6.019v.678a1 1 0 01-2 0v-.678a1 1 0 011-1z" />
    </svg>
</button>

<!-- Komut Dosyası -->
<script>
    const TEMEL_URL = "http://localhost:8080/users";

    // === DOM Seçicileri ===
    const kullaniciIdInput = document.getElementById("kullaniciId");
    const adInput          = document.getElementById("ad");
    const epostaInput      = document.getElementById("eposta");
    const kullaniciFormu   = document.getElementById("kullanici-formu");
    const tumunuGetirBtn   = document.getElementById("tumunuGetirBtn");
    const tabloGovde       = document.querySelector("#kullanicilarTablo tbody");
    const formBaslik       = document.getElementById("form-baslik");
    const gonderBtn        = document.getElementById("gonderBtn");
    const sifirlaBtn       = document.getElementById("sifirlaBtn");

    // Arama alanları
    const araIdInput       = document.getElementById("araId");
    const araAdInput       = document.getElementById("araAd");
    const araEpostaInput   = document.getElementById("araEposta");
    const araIdBtn         = document.getElementById("araIdBtn");
    const araAdBtn         = document.getElementById("araAdBtn");
    const araEpostaBtn     = document.getElementById("araEpostaBtn");
    const aramaSonuc       = document.getElementById("aramaSonuc");
    const sonucIcerik      = document.getElementById("sonucIcerik");

    // Tema anahtarı
    document.getElementById("temaBtn").addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      document.getElementById("temaIkon").classList.toggle("text-yellow-400");
      document.getElementById("temaIkon").classList.toggle("text-gray-100");
    });

    // === Yardımcı Fonksiyonlar ===
    const formuSifirla = () => {
      kullaniciIdInput.value = adInput.value = epostaInput.value = "";
      formBaslik.textContent = "Kullanıcı Oluştur";
      gonderBtn.textContent  = "Kullanıcı Oluştur";
    };

    const duzenlemeModu = (k) => {
      kullaniciIdInput.value = k.id;
      adInput.value          = k.name;
      epostaInput.value      = k.email;
      formBaslik.textContent = "Kullanıcı Güncelle";
      gonderBtn.textContent  = "Güncelle";
    };

    const aramaSonucGoster = (k) => {
      aramaSonuc.classList.remove("hidden");
      sonucIcerik.textContent = k && k.id
        ? `ID: ${k.id}\nAd ve Soyad: ${k.name}\nE-posta: ${k.email}`
        : "Kullanıcı bulunamadı.";
    };

    // === CRUD İşlemleri ===
    const tumKullanicilariGetir = async () => {
      try {
        const res = await fetch(TEMEL_URL);
        if (!res.ok) throw new Error(res.status);
        const kullanicilar = await res.json();

        // DESC sırala → son kayıt en üstte
        kullanicilar.sort((a, b) => b.id - a.id);

        tabloGovde.innerHTML = "";
        kullanicilar.forEach((k) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="px-3 py-2">${k.id}</td>
            <td class="px-3 py-2">${k.name}</td>
            <td class="px-3 py-2">${k.email}</td>
            <td class="px-3 py-2 space-x-2">
              <button class="rounded bg-amber-500 px-2 py-1 text-sm hover:bg-amber-600"
                      data-eylem="duzenle">Düzenle</button>
              <button class="rounded bg-red-500 px-2 py-1 text-sm hover:bg-red-600"
                      data-eylem="sil">Sil</button>
            </td>`;
          tr.querySelector('[data-eylem="duzenle"]')
            .addEventListener("click", () => duzenlemeModu(k));
          tr.querySelector('[data-eylem="sil"]')
            .addEventListener("click", () => kullaniciSil(k.id));
          tabloGovde.appendChild(tr);
        });
      } catch (err) {
        alert("Hata: " + err);
      }
    };

    const kullaniciSil = async (id) => {
      if (!confirm("Bu kullanıcıyı silmek istediğinize emin misiniz?")) return;
      try {
        const res = await fetch(`${TEMEL_URL}/${id}`, { method: "DELETE" });
        if (res.status === 204) tumKullanicilariGetir();
        else alert("Silme başarısız: " + res.status);
      } catch (err) {
        alert("Hata: " + err);
      }
    };

    // === Form Submit ===
    kullaniciFormu.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!kullaniciFormu.checkValidity()) {
        kullaniciFormu.reportValidity();
        return;
      }

      const id = kullaniciIdInput.value.trim();
      const kullaniciVerisi = {
        name:  adInput.value.trim(),
        email: epostaInput.value.trim(),
      };

      const ayarlar = {
        method: id ? "PUT" : "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(kullaniciVerisi),
      };
      const url = id ? `${TEMEL_URL}/${id}` : TEMEL_URL;

      try {
        const res = await fetch(url, ayarlar);
        if (!res.ok) throw new Error(res.status);
        await tumKullanicilariGetir();
        formuSifirla();
      } catch (err) {
        alert("Hata: " + err);
      }
    });

    sifirlaBtn.addEventListener("click", formuSifirla);
    tumunuGetirBtn.addEventListener("click", tumKullanicilariGetir);

    // === Arama İşlemleri ===
    araIdBtn.addEventListener("click", async () => {
      const id = araIdInput.value.trim();
      if (!id) return;
      try {
        const res = await fetch(`${TEMEL_URL}/${id}`);
        aramaSonucGoster(res.ok ? await res.json() : null);
      } catch (err) {
        alert("Hata: " + err);
      }
    });

    araAdBtn.addEventListener("click", async () => {
      const isim = araAdInput.value.trim();
      if (!isim) return;
      try {
        const res = await fetch(`${TEMEL_URL}/isim?isim=${encodeURIComponent(isim)}`);
        aramaSonucGoster(res.ok ? await res.json() : null);
      } catch (err) {
        alert("Hata: " + err);
      }
    });

    araEpostaBtn.addEventListener("click", async () => {
      const mail = araEpostaInput.value.trim();
      if (!mail) return;
      try {
        const res = await fetch(`${TEMEL_URL}/email?email=${encodeURIComponent(mail)}`);
        aramaSonucGoster(res.ok ? await res.json() : null);
      } catch (err) {
        alert("Hata: " + err);
      }
    });

    // === İlk Yükleme ===
    window.addEventListener("load", tumKullanicilariGetir);
</script>
</body>
</html>
